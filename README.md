# Google Voice Task Agent

A small web app that uses **Twilio Voice** to call you each morning, capture your spoken task list, and create tasks in **Google Tasks**.  
Built with **Flask (Python)**, deployable to **Google Cloud Run**, and tested locally using **ngrok**.

---

## Features

- **Daily Call** – Twilio rings your phone, prompts for tasks, and transcribes your speech.
- **Task Capture** – Parsed tasks are created automatically in your Google Tasks list.
- **On-Demand Call** – Trigger a "Call Me Now" endpoint anytime you want to dictate tasks.
- **Cloud Ready** – Runs locally with ngrok, or deployable to Google Cloud Run for production.
- **Extensible** – Can later add AI parsing, task labeling, or category grouping.

---

## Project Structure

```
google-voice-task-agent/
├─ src/
│  ├─ app.py              # Flask app: /voice, /capture, /call
│  └─ tools/
│     └─ google_tasks.py  # Google Tasks API wrapper
├─ scripts/
│  ├─ auth_google_local.py  # Run once locally to generate token.json
│  └─ dev.ps1               # PowerShell helper to run Flask + ngrok
├─ secrets/google/
│  ├─ credentials.json    # OAuth credentials (downloaded from Google Cloud Console)
│  └─ token.json          # OAuth refresh token (generated by auth_google_local.py)
├─ requirements.txt
├─ Dockerfile
├─ .env.example
└─ README.md
```

---

## Prerequisites

- **Windows 11**
- **VS Code**
- **Python 3.11+**
- **ngrok** (for local webhook testing)
- A **Twilio Account** (with a Voice-enabled number)
- A **Google Account** with the **Google Tasks API** enabled

---

## Setup

### 1. Clone the repo & create a virtual environment

```powershell
git clone https://github.com/cpdevoto/google-voice-task-agent.git
cd google-voice-task-agent
python -m venv .venv
.venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

### 2. Configure environment variables

Copy `.env.example` → `.env` and fill in:

```env
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_auth_token_here
TWILIO_NUMBER=+1XXXYYYZZZZ
YOUR_NUMBER=+1AAA BBB CCCC
FLASK_ENV=development
```

### 3. Set up Google Tasks API

1. In [Google Cloud Console](https://console.cloud.google.com/):

   - Enable **Google Tasks API**
   - Create OAuth Client ID (type: **Desktop App**)
   - Download `credentials.json` → save to `secrets/google/credentials.json`

2. Run the one-time auth flow:

```powershell
python scripts/auth_google_local.py
```

This will open a browser → authorize → write `secrets/google/token.json`.

### 4. Run locally

Start Flask:

```powershell
python -m flask --app src.app run -p 5000
```

Start ngrok (separate terminal):

```powershell
ngrok http 5000
```

### 5. Point Twilio to ngrok

1. Copy the HTTPS URL from ngrok (e.g., `https://abc123.ngrok.io`).
2. In [Twilio Console → Phone Numbers → Active Numbers → Voice & Fax → A Call Comes In]:
   - Set **Webhook** to `POST https://abc123.ngrok.io/voice`.

Now when Twilio calls your number, it will hit your Flask app.

---

## Testing

- **Call Me Now** (manual trigger):

  ```powershell
  Invoke-WebRequest -Uri "http://localhost:5000/call" -Method POST
  ```

  Twilio will ring `YOUR_NUMBER` immediately.

- **Speak tasks**: Say “Email Sara, review pull request, pick up dry cleaning.”  
  Each will appear in your Google Tasks list.

---

## Deploying to Cloud Run

1. Build and push the container:

   ```bash
   gcloud builds submit --tag us-central1-docker.pkg.dev/<PROJECT_ID>/app-repo/gvt-agent:v1
   ```

2. Deploy:

   ```bash
   gcloud run deploy gvt-agent      --image us-central1-docker.pkg.dev/<PROJECT_ID>/app-repo/gvt-agent:v1      --region us-central1      --allow-unauthenticated      --port 8080      --set-env-vars TWILIO_ACCOUNT_SID=...,TWILIO_AUTH_TOKEN=...,TWILIO_NUMBER=...,YOUR_NUMBER=...      --update-secrets GOOGLE_CREDENTIALS_FILE=GOOGLE_CREDENTIALS_JSON:latest      --update-secrets GOOGLE_TOKEN_FILE=GOOGLE_TOKEN_JSON:latest
   ```

3. Update Twilio webhook to point at the new Cloud Run URL.

4. (Optional) Use **Cloud Scheduler** to trigger `/call` automatically every morning.

---

## Roadmap

- [ ] Add simple AI parsing (understand “today 3 pm” → set due time).
- [ ] Group tasks into Work vs Personal.
- [ ] SMS confirmation of captured tasks.
- [ ] Error logging + retries.

---

## License

MIT

## Running through VS Code

- In VS Code press **Ctrl+Shift+P => "Tasks: Run Task" => "Dev: Start (Flask + ngrok)"**. This opens two terminals: one for Flask and one for ngrok.
- To trigger the test call anytime, run **Ctrl+Shift+P => "Tasks: Run Task" => "Call Me Now"** and paste your `/call` URL (Must use the ngrok URL with `/call` appended to it).
- Test with the following tasks "Email Sara, review PR, book dentist"
